<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bukpot Express</title>
    <link rel="stylesheet" href="popup.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="card">
        <div class="header">
            <div class="header-left">
                <img src="images/icon48.png" alt="Logo">
                <h2 class="header-title">Bukpot Express</h2>
            </div>
            <div class="header-right">
                <button id="themeToggle" class="theme-toggle" title="Toggle theme">
                    <span class="theme-icon">üåô</span>
                </button>
            </div>
        </div>

        <!-- Main UI Section -->
        <div id="main-section" class="container">
            <!-- Cara Penggunaan Section -->
          <div class="tutorial-section">
              <div class="tutorial-header" id="tutorialToggle">
                  <span class="tutorial-title">üìñ Cara Penggunaan</span>
                  <span class="toggle-icon" id="toggleIcon">‚ñº</span>
              </div>
              <div class="tutorial-content" id="tutorialContent">
                  <div class="tutorial-steps">
                      <div class="step">
                          <h4>üéØ Langkah 1: Persiapan</h4>
                          <p>Login ke Coretax DJP dan buka halaman "Bukti Potong" (BPPU atau BP series)</p>
                      </div>
                      <div class="step">
                          <h4>üìÖ Langkah 2: Pilih Masa Pajak</h4>
                          <p>Pilih bulan dan tahun yang diinginkan</p>
                      </div>
                      <div class="step">
                          <h4>‚¨áÔ∏è Langkah 3: Mulai Download</h4>
                          <p>Klik tombol "Filter & Download"</p>
                      </div>
                      <div class="step">
                          <h4>‚è±Ô∏è Langkah 4: Tunggu Proses</h4>
                          <p>Download otomatis dengan jeda antar file</p>
                      </div>
                  </div>
              </div>
          </div>

            <!-- Tax Period Filter Section -->
            <div class="filter-section">
                <h3>Filter Masa Pajak</h3>
                <p id="filterHelper" class="filter-helper">Pilih bulan dan tahun masa pajak sebelum memulai download.</p>
                <div class="filter-controls">
                    <select id="bulanSelect">
                        <option value="">Pilih Bulan</option>
                        <option value="01">Januari</option>
                        <option value="02">Februari</option>
                        <option value="03">Maret</option>
                        <option value="04">April</option>
                        <option value="05">Mei</option>
                        <option value="06">Juni</option>
                        <option value="07">Juli</option>
                        <option value="08">Agustus</option>
                        <option value="09">September</option>
                        <option value="10">Oktober</option>
                        <option value="11">November</option>
                        <option value="12">Desember</option>
                    </select>

                    <select id="tahunSelect">
                        <option value="">Pilih Tahun</option>
                    </select>
                </div>
            </div>

            <!-- Download Mode Section -->
            <div class="download-mode-section">
                <h3>Mode Download</h3>
                <div class="mode-controls">
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="downloadMode" value="all">
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <span class="radio-text">Download Semua Halaman</span>
                                <span class="radio-subtext">Terapkan filter masa pajak lalu lanjutkan otomatis hingga halaman terakhir.</span>
                            </div>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="downloadMode" value="single" checked>
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <span class="radio-text">Download Satu Halaman</span>
                                <span class="radio-subtext">Gunakan filter yang sedang aktif di halaman Coretax tanpa mengubah pilihan masa pajak.</span>
                            </div>
                        </label>
                    </div>
                    <div id="modeInfo" class="mode-info">Download Satu Halaman mengunduh halaman yang sedang tampil tanpa mengganti filter.</div>
                </div>
            </div>

            <!-- Download Action Section -->
            <div class="download-action-section">
                <button id="filterBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="icon">
                        <path d="M12 15.25a.75.75 0 01-.75-.75V4.75a.75.75 0 011.5 0V14.5a.75.75 0 01-.75-.75z" />
                        <path d="M18.25 14a.75.75 0 00-.53 1.28l-5 5a.75.75 0 00-1.06 0l-5-5a.75.75 0 00-1.06 1.06l5 5a2.25 2.25 0 003.18 0l5-5a.75.75 0 00-.53-1.34z" />
                    </svg>
                    <span>Filter & Download</span>
                </button>
                <button id="stopBtn" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="icon">
                        <path d="M6 6h12v12H6V6z" />
                    </svg>
                    <span>STOP Download</span>
                </button>
            </div>

            <!-- Alternative Stop Section -->
            <div class="alternative-stop-section">
                <button id="hardForceStopBtn" class="alternative-stop-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="icon">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                    <span>Force Close Browser</span>
                </button>
            </div>

            <!-- Useful Tips Section -->
            <div class="tips-section">
                <div class="tips-header" id="tipsToggle">
                    <span class="tips-title">üí° Tips Penting</span>
                    <span class="toggle-icon" id="tipsToggleIcon">‚ñº</span>
                </div>
                <div class="tips-content" id="tipsContent">
                    <div class="tip-item">
                        <h4>‚è∞ Waktu Terbaik Penggunaan</h4>
                        <div class="tip-steps">
                            <p><strong>Dianjurkan untuk menggunakan BukpotExpress saat Coretax sedang lancar:</strong></p>
                            <ul>
                                <li><strong>Hindari jam sibuk:</strong> Menjelang batas waktu pelaporan</li>
                                <li><strong>Stabilkan koneksi:</strong> Pastikan internet stabil sebelum memulai download</li>
                                <li><strong>Refresh halaman:</strong> Refresh halaman Coretax sebelum mulai untuk memastikan data terbaru</li>
                            </ul>
                        </div>
                    </div>

                    <div class="tip-item">
                        <h4>üîÑ Cara Reload Ekstensi Manual</h4>
                        <div class="tip-steps">
                            <p><strong>Jika ekstensi tidak merespon atau error:</strong></p>
                            <ol>
                                <li>Buka <strong>chrome://extensions</strong> di tab baru</li>
                                <li>Cari "Bukpot Express" dalam daftar</li>
                                <li><strong>Aktifkan/Nonaktifkan</strong> ekstensi dengan tombol On/Off</li>
                                <li><strong>Aktifkan kembali</strong> dan kembali ke halaman Coretax</li>
                            </ol>
                        </div>
                    </div>

                    <div class="tip-item">
                        <h4>‚èπÔ∏è Cara Menghentikan Download</h4>
                        <div class="tip-steps">
                            <p><strong>Jika download sedang berjalan dan ingin dihentikan:</strong></p>
                            <ol>
                                <li><strong>Cara 1:</strong> Klik tombol <strong>STOP Download</strong> (normal stop)</li>
                                <li><strong>Cara 2:</strong> Klik tombol <strong>Force Close Browser</strong> (alternative stop)</li>
                                <li><strong>Cara 3:</strong> Tutup browser Chrome secara manual</li>
                            </ol>

                            <div class="tip-note">
                                <p><strong>üí° Catatan:</strong></p>
                                <p>‚Ä¢ Force Close Browser akan menutup seluruh browser Chrome</p>
                                <p>‚Ä¢ Semua proses download akan berhenti</p>
                                <p>‚Ä¢ Anda bisa membuka kembali browser dan melanjutkan</p>
                                <p>‚Ä¢ Gunakan jika tombol STOP tidak berfungsi</p>
                            </div>
                        </div>
                    </div>

                    <div class="tip-item">
                        <h4>üîß Solusi Masalah Umum</h4>
                        <div class="tip-steps">
                            <ul>
                                <li><strong>Extension tidak merespon:</strong> Reload ekstensi secara manual</li>
                                <li><strong>Download macet:</strong> Stop lalu mulai kembali</li>
                                <li><strong>Halaman error:</strong> Refresh halaman Coretax dan coba lagi</li>
                                <li><strong>Permission denied:</strong> Reload ekstensi dan refresh halaman</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Log Section -->
            <div class="status-section">
                <h3>Status Log</h3>
                <div id="statusLog" class="status-log">Status: Menunggu perintah...</div>
                <div class="log-controls">
                    <button id="clearLogBtn">Clear Log</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Unified Footer Section -->
    <div class="footer-section">
        <!-- Promotional Cards -->
        <div class="promo-cards">
            <div class="promo-card" id="efaktur-card">
                <div class="promo-icon">üöÄ</div>
                <div class="promo-content">
                    <h3 class="promo-title">Cape Kreditkan Pajak Masukan?</h3>
                    <p class="promo-description">Otomatisasikan dengan <a href="https://chromewebstore.google.com/detail/e-faktur-automation/hjimkdiphhenkofkbbicaejhflmoicpg" class="promo-link">E-faktur Automation</a></p>
                </div>
            </div>

            <div class="promo-card" id="coffee-card">
                <div class="promo-icon">‚òï</div>
                <div class="promo-content">
                    <h3 class="promo-title">Dukung Developer</h3>
                    <p class="promo-description">Dukung pengembangan dengan <a href="https://trakteer.id/alatpajakid/tip" class="promo-link">Buy Me Coffee</a></p>
                </div>
            </div>
        </div>

        <!-- Support Community Section -->
        <div class="support-community">
            <div class="community-message">
                <div class="community-icon">üíö</div>
                <p class="community-text">Didukung oleh <strong><a href="https://alatpajak.id/" target="_blank" class="promo-link">alatpajak.id</a></strong></p>
                <p class="community-subtext">ü§ù Ekstensi ini tersedia gratis untuk komunitas pajak Indonesia</p>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <div class="loading-text">Processing...</div>
    </div>

    <!-- App Scripts -->
    <script src="popup.js"></script>
</body>
</html>
